name: postgis
version: 0.0.4
inherits: wercker/postgresql@0.0.4
type: service
platform: ubuntu@12.04
description: wercker box for postgis install via the ubuntugis ppa
keywords:
  - postgist
  - gis
  - geo
  - postgresql
packages:
  - python-software-properties
  - postgresql@9.1
  - postgis
env:
  WERCKER_POSTGRESQL_HOST: $$HOST$$
  WERCKER_POSTGRESQL_USERNAME: postgres
  WERCKER_POSTGRESQL_PASSWORD: wercker
  WERCKER_POSTGRESQL_PORT: 5432
  WERCKER_POSTGRESQL_DATABASE: werckerdb1
  WERCKER_POSTGRESQL_URL: postgres://postgres:wercker@$$HOST$$:5432/werckerdb1
script: |
  echo "deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main" | sudo tee -a /etc/apt/sources.list.d/postgresql.list
  wget --quiet -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | sudo apt-key add -
   
  apt-get install libgeos-dev libproj-dev libgdal-dev -y -q
  wget http://download.osgeo.org/postgis/source/postgis-2.0.3.tar.gz
  tar xvzf postgis-2.0.3.tar.gz
  cd postgis-2.0.3
  ./configure
  make
  make install

  PGPASSWORD=wercker psql -h localhost -U postgres -d werckerdb1 -c 'CREATE EXTENSION IF NOT EXISTS postgis;'
  PGPASSWORD=wercker psql -h localhost -U postgres -d werckerdb1 -c 'CREATE EXTENSION IF NOT EXISTS postgis_topology;'
